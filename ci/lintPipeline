properties([
    pipelineTriggers([
        pollSCM('H/1 * * * *')
    ])
])

node {
    stage('install dependencies') {
        // Clone the repo
        git credentialsId: 'GIT_EPAM_PAT', url: 'https://git.epam.com/anton_rak/set_basic_api_js.git', branch: 'master'

        // Install dependencies for API
        sh 'npm install'

        // Start API server in background
        sh 'npm run start_server &'

        // Optional: start UI part
        sh 'cd ui_part && node app.js &'

        // Give servers a few seconds to start
        sh 'sleep 5'
    }

    stage('lint') {
        sh 'npm run lint'
    }

    

    // stage('unit tests coverage') {
    //     sh 'npm run unit_tests_coverage'
    // }
}
