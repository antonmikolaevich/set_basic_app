<section>
  <form id="searchBookingForm" class="row g-3">
    <div class="row align-items-center mb-3 pt-4">
    <!-- Product Id -->
    <div class="col-md-2 text-start">
      <label for="searchUserName" class="form-label mb-0">User Name</label>
    </div>
    <div class="col-md-4">
      <input id="searchUserName" name="userName" class="form-control">
    </div>

    <!-- Product Name -->
    <div class="col-md-2 text-start">
      <label for="searchProductName" class="form-label mb-0">Product Name</label>
    </div>
    <div class="col-md-4">
      <input id="searchProductName" name="productName" class="form-control">
    </div>

  </div>

  <div class="row align-items-center mb-3">
    <div class="col-md-2 text-start">
      <label for="searchDate" class="form-label mb-0">Date</label>
    </div>
    <div class="col-md-4">
      <input id="searchDate" name="date" class="form-control">
    </div>
     <div class="col-md-2 text-start">
      <label for="searchAddress" class="form-label mb-0">Address</label>
    </div>
    <div class="col-md-4">
      <input id="searchAddress" name="address" class="form-control">
    </div>
  </div>

  <div class="row align-items-center mb-3">
    <div class="col-md-2 text-start">
      <label for="searchStatus" class="form-label mb-0">Status</label>
    </div>
    <div class="col-md-4">
      <select id="searchStatus" name="status" class="form-control">
        <option value="" selected>Small select</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
        <option value="closed">Closed</option>
      </select>
    </div>
    <div class="col-md-6 text-end">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
    </div>

  </form>

  <div id="searchBookingResult" class="mt-3"></div>
</section>

<section class="row mb-3">
  <div class="col">
    <h3>Search Results</h3>
  </div>
</section>

<section class="row mt-4 d-flex flex-wrap" id="bookingCards">

  <% if (bookings && bookings.length > 0) { %>

    <% bookings.forEach(booking => { %>

      <div class="col-md-4 mb-4 card-wrapper">
        <div class="card shadow-sm">

          <!-- IMAGE AREA -->
          <div class="card-img-top bg-secondary text-white text-center p-5 fs-5">
            <% if (booking.product_id?.image_path) { %>
              <img 
                src="<%= booking.product_id.image_path %>" 
                alt="Product Image" 
                class="img-fluid"
              >
            <% } else { %>
              Product Image
            <% } %>
          </div>

          <!-- PRODUCT MAIN INFO -->
          <div class="card-body py-3">
            <div class="ms-3">
            <h5 class="mb-1"><%= booking.product_id?.name %></h5>
            <p class="text-muted mb-1"><%= booking.product_id?._id %></p>
            </div>
          </div>

          <!-- DETAILS LIST -->
          <ul class="list-group list-group-flush">

            <li class="list-group-item">
              <span class="ms-1"><%= booking.user_id?.name || "N/A" %></span>
            </li>

            <li class="list-group-item">
              <span class="ms-1"><%= booking.delivery_date 
        ? booking.delivery_date.match(/\d{4}-\d{2}-\d{2}/)[0] 
        : "N/A" %></span>
            </li>

            <li class="list-group-item">
              <span class="ms-1">
                <%= booking.delivery_time 
                    ? new Date(booking.delivery_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                    : "N/A" 
                %>
              </span>
            </li>

            <li class="list-group-item">
              <span class="ms-1"><%= booking.delivery_address || "N/A" %></span>
            </li>

            <li class="list-group-item">
              <span class="ms-1"><%= booking.status_id?.name || "Pending" %></span>
            </li>

          </ul>

          <!-- ACTION BUTTONS -->
        <div class="card-footer d-flex gap-2">
  <button class="btn btn-success btn-sm flex-grow-1" data-id="<%= booking._id %>" data-status="APPROVED">Approve</button>
  <button class="btn btn-danger btn-sm flex-grow-1" data-id="<%= booking._id %>" data-status="REJECTED">Reject</button>
  <button class="btn btn-primary btn-sm flex-grow-1" data-id="<%= booking._id %>" data-status="CLOSED">Close</button>
</div>


        </div>
      </div>

    <% }) %>

  <% } else { %>

    <p>No bookings found.</p>

  <% } %>

</section>

<div class="d-flex justify-content-end align-items-center mt-4">

    <button class="btn btn-success me-3" id="openCreateBookingBtn">
    Create
  </button>

<!-- PAGINATION -->
<% if (totalPages && totalPages > 1) { %>
  <nav aria-label="Bookings pagination" class="mt-4">
    <ul class="pagination justify-content-end">

      <!-- Previous -->
      <% if (currentPage > 1) { %>
        <li class="page-item">
          <a class="page-link" href="/bookings?page=<%= currentPage - 1 %>">Previous</a>
        </li>
      <% } else { %>
        <li class="page-item disabled">
          <span class="page-link">Previous</span>
        </li>
      <% } %>

      <!-- Page numbers -->
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
          <a class="page-link" href="/bookings?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>

      <!-- Next -->
      <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a class="page-link" href="/bookings?page=<%= currentPage + 1 %>">Next</a>
        </li>
      <% } else { %>
        <li class="page-item disabled">
          <span class="page-link">Next</span>
        </li>
      <% } %>

    </ul>
  </nav>
<% } %>

</div>
